{% extends "base.html" %}

{% block title %}{{ category }} - Library - K.{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="d-flex justify-content-between align-items-center mb-5">
        <div>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb mb-2">
                    <li class="breadcrumb-item"><a href="{{ url_for('library_index') }}"
                            class="text-decoration-none text-muted">Library</a></li>
                    <li class="breadcrumb-item active" aria-current="page">{{ category }}</li>
                </ol>
            </nav>
            <h1 class="display-5 fw-bold" style="font-family: 'Inter', sans-serif;">{{ category }}</h1>
        </div>

        {% if current_user.is_authenticated and current_user.is_member() %}
        <button class="btn btn-dark" type="button" data-bs-toggle="collapse" data-bs-target="#uploadForm"
            aria-expanded="false" aria-controls="uploadForm">
            Upload Book
        </button>
        {% endif %}
    </div>

    <!-- Upload Form (Collapsed by default) -->
    <div class="collapse mb-5" id="uploadForm">
        <div class="card card-body border-0 shadow-sm bg-light">
            <h5 class="mb-3">Upload New Book</h5>
            <form action="{{ url_for('upload_book', category=category) }}" method="post" enctype="multipart/form-data">
                <div class="mb-3">
                    <label for="file" class="form-label">Book File</label>
                    <input class="form-control" type="file" id="file" name="file" required>
                </div>
                <button type="submit" class="btn btn-primary">Upload</button>
            </form>
        </div>
    </div>

    <!-- Books List -->
    <div class="list-group shadow-sm">
        {% for book in books %}
        <div class="list-group-item list-group-item-action p-4 border-0 border-bottom">
            <div class="d-flex w-100 justify-content-between align-items-center">
                <div>
                    <h5 class="mb-1 fw-bold">{{ book.title }}</h5>
                    <p class="mb-1 text-muted">{{ book.author }}</p>
                    <small class="text-muted">Added: {{ book.upload_date.strftime('%Y-%m-%d') }}</small>
                </div>
                <div class="d-flex gap-2 align-items-center">
                    {% if current_user.is_authenticated and current_user.is_member() %}
                    <a href="{{ url_for('download_book', book_id=book.id) }}" class="btn btn-outline-dark btn-sm">
                        Download
                    </a>
                    {% endif %}

                    {% if current_user.is_authenticated and current_user.is_admin() %}
                    <form action="{{ url_for('toggle_book_public', book_id=book.id) }}" method="post" class="d-inline">
                        <button type="submit"
                            class="btn btn-sm {{ 'btn-success' if book.is_public else 'btn-warning' }}"
                            title="{{ 'Click to hide from public' if book.is_public else 'Click to make public' }}">
                            {{ 'üëÅÔ∏è Public' if book.is_public else 'üîí Hidden' }}
                        </button>
                    </form>
                    {% endif %}
                </div>
            </div>
        </div>
        {% else %}
        <div class="list-group-item p-5 text-center text-muted">
            No books in this category yet.
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}