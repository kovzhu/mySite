{% extends "base.html" %}

{% block title %}Ideas - K.{% endblock %}

{% block content %}
<div class="container py-5">
    <!-- Quotes Section -->
    <section class="mb-5">
        <h2 class="display-4 mb-5 text-center"
            style="font-family: 'Inter', sans-serif; font-weight: 900; letter-spacing: -1px;">Perspectives</h2>
        <div class="row g-4" id="quotes-grid">
            <!-- 6 Quote Slots -->
            {% for i in range(6) %}
            <div class="col-md-6 col-lg-4">
                <div class="card h-100 border-0 shadow-sm quote-card"
                    style="background: #ffffff; transition: transform 0.3s ease; border-radius: 12px; cursor: pointer;">
                    <div class="card-body d-flex flex-column justify-content-center align-items-center text-center p-4">
                        <p class="card-text fs-5 fst-italic quote-text mb-3"
                            style="font-family: 'Georgia', serif; color: #333; min-height: 120px; max-height: 120px; display: flex; align-items: center; justify-content: center; overflow: hidden; position: relative;">
                            Loading...</p>
                        <div class="quote-overlay" style="display: none; position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(to top, rgba(255,255,255,0.9), transparent); padding: 20px 10px 5px; text-align: center;">
                            <small class="text-muted">Click to expand</small>
                        </div>
                        <footer class="blockquote-footer mt-auto quote-author"
                            style="font-family: 'Inter', sans-serif; font-size: 0.9rem;"></footer>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </section>

    <hr class="my-5" style="opacity: 0.1;">

    <!-- Books Section -->
    <section>
        <h2 class="display-4 mb-5 text-center"
            style="font-family: 'Inter', sans-serif; font-weight: 900; letter-spacing: -1px;">Library</h2>
        <div class="row g-4">
            {% for category in categories %}
            <div class="col-md-4 col-lg-3">
                <a href="{{ url_for('library_category', category=category) }}" class="text-decoration-none">
                    <div class="card h-100 border-0 shadow-sm hover-card" style="transition: transform 0.3s ease;">
                        <div class="card-body d-flex flex-column justify-content-center align-items-center p-5 text-center"
                            style="background: #f8f9fa; border-radius: 12px;">
                            <div class="mb-3" style="font-size: 3rem;">ðŸ“š</div>
                            <h5 class="card-title fw-bold text-dark mb-0">{{ category }}</h5>
                        </div>
                    </div>
                </a>
            </div>
            {% else %}
            <div class="col-12 text-center">
                <p class="text-muted">No categories found.</p>
            </div>
            {% endfor %}
        </div>
    </section>
</div>
{% endblock %}

{% block scripts %}
<script>
    const allQuotes = {{ quotes | tojson }};
    const quoteCards = document.querySelectorAll('.quote-card');

    function getRandomQuote() {
        if (!allQuotes || allQuotes.length === 0) return { text: "No quotes available", author: "" };
        return allQuotes[Math.floor(Math.random() * allQuotes.length)];
    }

    function updateCard(card) {
        const textEl = card.querySelector('.quote-text');
        const authorEl = card.querySelector('.quote-author');
        const overlayEl = card.querySelector('.quote-overlay');

        // Fade out
        textEl.style.opacity = 0;
        authorEl.style.opacity = 0;

        setTimeout(() => {
            const quote = getRandomQuote();
            textEl.textContent = `"${quote.text}"`;
            authorEl.textContent = quote.author;

            // Check if quote needs truncation
            checkQuoteLength(textEl, overlayEl);

            // Fade in
            textEl.style.opacity = 1;
            authorEl.style.opacity = 1;
        }, 500);
    }

    function checkQuoteLength(textEl, overlayEl) {
        // Reset to default state
        textEl.style.maxHeight = '120px';
        textEl.style.overflow = 'hidden';
        textEl.classList.remove('expanded');
        
        // Check if text overflows
        if (textEl.scrollHeight > textEl.clientHeight) {
            overlayEl.style.display = 'block';
        } else {
            overlayEl.style.display = 'none';
        }
    }

    function toggleQuoteExpansion(card) {
        const textEl = card.querySelector('.quote-text');
        const overlayEl = card.querySelector('.quote-overlay');
        
        if (textEl.classList.contains('expanded')) {
            // Collapse
            textEl.style.maxHeight = '120px';
            textEl.style.overflow = 'hidden';
            textEl.classList.remove('expanded');
            overlayEl.style.display = 'block';
        } else {
            // Expand
            textEl.style.maxHeight = 'none';
            textEl.style.overflow = 'visible';
            textEl.classList.add('expanded');
            overlayEl.style.display = 'none';
        }
    }

    if (allQuotes && allQuotes.length > 0) {
        quoteCards.forEach((card, index) => {
            // Initial set
            const quote = getRandomQuote();
            const textEl = card.querySelector('.quote-text');
            const overlayEl = card.querySelector('.quote-overlay');
            
            textEl.textContent = `"${quote.text}"`;
            card.querySelector('.quote-author').textContent = quote.author;

            // Check initial quote length
            setTimeout(() => checkQuoteLength(textEl, overlayEl), 100);

            // Add staggered initial rotation for visual interest
            setTimeout(() => {
                updateCard(card);
            }, 1000 + (index * 500)); // Staggered rotation: 1s, 1.5s, 2s, etc.

            // Set random interval for rotation (between 3s and 8s) - faster rotation
            const interval = Math.floor(Math.random() * 5000) + 3000;

            setInterval(() => {
                updateCard(card);
            }, interval);

            // Add click event for expansion
            card.addEventListener('click', () => {
                toggleQuoteExpansion(card);
            });
        });
    }

    // Add CSS transition for opacity
    const style = document.createElement('style');
    style.innerHTML = `
        .quote-text, .quote-author {
            transition: opacity 0.5s ease-in-out;
        }
        .quote-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 1rem 3rem rgba(0,0,0,.1) !important;
        }
        .quote-text {
            transition: max-height 0.3s ease-in-out, opacity 0.5s ease-in-out;
        }
        .quote-overlay {
            transition: opacity 0.3s ease-in-out;
        }
    `;
    document.head.appendChild(style);
</script>
{% endblock %}
